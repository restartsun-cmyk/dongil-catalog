<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ ì² ë¬¼ ì¹´íƒˆë¡œê·¸</title>
    <style>
        /* ìŠ¤íƒ€ì¼ì€ ê¸°ì¡´ê³¼ ë™ì¼í•©ë‹ˆë‹¤ */
        :root { --main-color: #2c3e50; --accent-color: #e74c3c; --bg-color: #f4f6f7; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; }
        
        header { background-color: var(--main-color); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { margin: 0; font-size: 1.2rem; }
        
        .mode-switch { background: none; border: 1px solid white; color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; }
        .mode-active { background-color: var(--accent-color); border-color: var(--accent-color); }

        .container { padding: 10px; max-width: 800px; margin: 0 auto; }
        .product-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(100%, 1fr)); gap: 15px; }
        
        .card { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; }
        .card-img { width: 100px; height: 100px; background-color: #ddd; object-fit: cover; flex-shrink: 0; display: flex; align-items: center; justify-content: center; color: #666; font-size: 0.8rem;}
        .card-body { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }
        
        .cat-badge { font-size: 0.7rem; color: #666; background: #eee; padding: 2px 6px; border-radius: 4px; align-self: flex-start; margin-bottom: 5px;}
        .p-name { font-weight: bold; font-size: 1.1rem; margin: 0; color: #333; }
        .p-spec { font-size: 0.9rem; color: #555; margin-top: 2px; }
        .p-box { font-size: 0.8rem; color: #888; margin-top: 2px; }

        .price-area { margin-top: 8px; text-align: right; }
        .price-consumer { font-weight: bold; color: #333; }
        .price-dealer { display: none; color: var(--accent-color); font-weight: bold; font-size: 1.1rem; }
        
        body.consult-mode .price-dealer { display: block; }
        body.consult-mode .price-consumer { text-decoration: line-through; color: #999; font-size: 0.8rem; }
        body.consult-mode .dealer-label { display: inline-block; font-size: 0.7rem; background: var(--accent-color); color: white; padding: 2px 4px; border-radius: 3px; margin-right: 5px;}
        
        /* ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .error-box { background: #fee; color: #c00; padding: 15px; border-radius: 5px; font-size: 0.9rem; line-height: 1.4; border: 1px solid #fcc; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ”§ ìš°ë¦¬ì² ë¬¼ ì¹´íƒˆë¡œê·¸</h1>
    <button id="modeBtn" class="mode-switch" onclick="toggleMode()">ğŸ”’ ê³ ê°ìš©</button>
</header>

<div class="container">
    <div id="productList" class="product-list">
        <div style="text-align:center; padding: 20px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>
</div>

<script>
    // [í•´ê²°ì±…] ë§ˆìŠ¤í„°ì˜ êµ¬ê¸€ ì‹œíŠ¸ ì£¼ì†Œë¥¼ 'CORS ìš°íšŒ ì„œë²„(AllOrigins)'ë¥¼ í†µí•´ ê±°ì³ì˜¤ë„ë¡ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.
    // ì´ë ‡ê²Œ í•˜ë©´ ë¡œì»¬ íŒŒì¼ì—ì„œë„ ì•ˆì „í•˜ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const ORIGINAL_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTks8AtO1044gxBtvCP7SU70ftGdrQhEWXxvfykM9MYcOwRsVXE9TkIeJuosxaY29-03dUtNZ6D6zms/pub?gid=0&single=true&output=csv";
    const PROXY_URL = "https://api.allorigins.win/raw?url=" + encodeURIComponent(ORIGINAL_URL);

    async function loadData() {
        try {
            // PROXY_URLì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.
            const response = await fetch(PROXY_URL);
            
            if (!response.ok) throw new Error("ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            
            const data = await response.text();
            
            // ë°ì´í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            if(!data || data.length < 10) throw new Error("ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìœ¼ë‚˜ ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");

            const rows = data.split('\n').slice(1); 
            const listDiv = document.getElementById('productList');
            listDiv.innerHTML = ""; 

            let count = 0;
            rows.forEach(row => {
                // ì‰¼í‘œ ì²˜ë¦¬ ë¡œì§
                const cols = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                const cleanCols = cols.map(c => c.replace(/^"|"$/g, '').trim()); 

                if(cleanCols.length < 2) return; 

                const item = {
                    cat: cleanCols[0],
                    name: cleanCols[1],
                    spec: cleanCols[2],
                    box: cleanCols[3],
                    img: cleanCols[4],
                    p_dealer: cleanCols[5], 
                    p_ref: cleanCols[7]     
                };

                const imgDisplay = (item.img && item.img.startsWith('http')) 
                    ? `<img src="${item.img}" class="card-img">` 
                    : `<div class="card-img">ì´ë¯¸ì§€<br>ì¤€ë¹„ì¤‘</div>`;
                
                const cardHtml = `
                    <div class="card">
                        ${imgDisplay}
                        <div class="card-body">
                            <div class="cat-badge">${item.cat}</div>
                            <h3 class="p-name">${item.name}</h3>
                            <div class="p-spec">${item.spec}</div>
                            <div class="p-box">ğŸ“¦ ${item.box}</div>
                            <div class="price-area">
                                <div class="price-consumer">ê¶Œì¥ê°€: ${formatMoney(item.p_ref)}</div>
                                <div class="price-dealer"><span class="dealer-label">ë„ë§¤</span> ${formatMoney(item.p_dealer)}</div>
                            </div>
                        </div>
                    </div>
                `;
                listDiv.innerHTML += cardHtml;
                count++;
            });

            if(count === 0) listDiv.innerHTML = "<div style='text-align:center'>í‘œì‹œí•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>";

        } catch (error) {
            console.error(error);
            // ì—ëŸ¬ê°€ ë‚˜ë©´ ì •í™•í•œ ì´ìœ ë¥¼ í™”ë©´ì— ë³´ì—¬ì¤ë‹ˆë‹¤.
            document.getElementById('productList').innerHTML = `
                <div class="error-box">
                    <strong>âš ï¸ ì˜¤ë¥˜ ë°œìƒ</strong><br>
                    ${error.message}<br><br>
                    í˜¹ì‹œ êµ¬ê¸€ ì‹œíŠ¸ 'ì›¹ì— ê²Œì‹œ'ê°€ ì¤‘ë‹¨ë˜ì—ˆê±°ë‚˜, ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                </div>`;
        }
    }

    function formatMoney(str) {
        if(!str) return "ë¬¸ì˜";
        return Number(String(str).replace(/[^0-9]/g,'')).toLocaleString() + "ì›";
    }

    function toggleMode() {
        const body = document.body;
        const btn = document.getElementById('modeBtn');
        body.classList.toggle('consult-mode');
        
        if (body.classList.contains('consult-mode')) {
            btn.textContent = "ğŸ”“ ìƒë‹´ìš©";
            btn.classList.add('mode-active');
        } else {
            btn.textContent = "ğŸ”’ ê³ ê°ìš©";
            btn.classList.remove('mode-active');
        }
    }

    loadData();
</script>

</body>
</html>
